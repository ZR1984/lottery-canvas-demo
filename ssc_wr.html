<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- <script src="./lib/TweenMax.min.js"></script> -->
    <script src="./test.js"></script>
</head>

<body>
    <div class="lotteryAnimat">
        <canvas id="canvas" width="1124" height="708">很抱歉，您的浏览器不支持canvas！</canvas>

    </div>

    <script>
        const bgImg = new LotteryTool(document.querySelector("#canvas"), {
            imgUrls: "./image/1_new.png",
            canvasWidth: 1124,
            canvasHeight: 708,
        }).drawImage();

        const topNumber = new LotteryTool('.lotteryAnimat', {
            numStr: "25879",
            numDirection: 'horizontal',
            numPosition: {
                x: 0,
                y: 0
            },
            numType: 'top-middle',
            numStep: 75,
            numImgWidth: 80,
            numImgHeight: 80,
            canvasWidth: 400,
            canvasHeight: 90,
            canvasPosition: {
                x: 450,
                y: 5
            },
        }).drawImage()

        const currentPeriods = new LotteryTool('.lotteryAnimat', {
            numStr: "20181101008",
            numDirection: 'horizontal',
            numPosition: {
                x: 0,
                y: 0
            },
            numType: 'periods',
            numStep: 15,
            numImgWidth: 30,
            numImgHeight: 30,
            canvasWidth: 200,
            canvasHeight: 50,
            canvasPosition: {
                x: 225,
                y: 18
            },
        }).drawImage()

        const nextPeriods = new LotteryTool('.lotteryAnimat', {
            numStr: "20181101008",
            numDirection: 'horizontal',
            numPosition: {
                x: 0,
                y: 0
            },
            numType: 'periods',
            numStep: 15,
            numImgWidth: 30,
            numImgHeight: 30,
            canvasWidth: 200,
            canvasHeight: 50,
            canvasPosition: {
                x: 910,
                y: 10
            },
        }).drawImage()

        const lotteryTime = new LotteryTool('.lotteryAnimat', {
            numStr: "14:10:00",
            numDirection: 'horizontal',
            numPosition: {
                x: 0,
                y: 0
            },
            numType: 'lottery-time',
            numStep: 13,
            numImgWidth: 30,
            numImgHeight: 30,
            canvasWidth: 200,
            canvasHeight: 50,
            canvasPosition: {
                x: 950,
                y: 50
            },
        }).drawImage()

        const countDown = new LotteryTool('.lotteryAnimat', {
            numStr: "10",
            numDirection: 'horizontal',
            numPosition: {
                x: 0,
                y: 0
            },
            numType: 'count-down',
            numStep: 35,
            numImgWidth: 60,
            numImgHeight: 60,
            canvasWidth: 120,
            canvasHeight: 50,
            canvasPosition: {
                x: 500,
                y: 100
            },
        }).drawImage()

        const rollNumbers = []
        createRollNumbers()

        function createRollNumbers() {
            for (let index = 0; index < 5; index++) {
                rollNumbers.push(
                    new LotteryTool('.lotteryAnimat', {
                        numStr: "0123456789",
                        numDirection: 'vertical',
                        numPosition: {
                            x: 0,
                            y: 50
                        },
                        numStep: 100,
                        numImgWidth: 100,
                        numImgHeight: 100,
                        isRoll: true,
                        rollDirection: 'down',
                        canvasWidth: 100,
                        canvasHeight: 320,
                        canvasPosition: {
                            x: 160 + index * 170,
                            y: 180
                        },
                        winnerPosition: {
                            y: 120
                        },
                        rollSpeed: rand(10, 25)
                    })
                )
            }
        }

        //滚动动画
        frame()

        function frame() {
            rollNumbers.forEach(colObj => {
                colObj.drawImage()
            })
            requestAnimationFrame(frame)
        }

        const watch = new CountDownWatch(10, {
            onUpdate: (count) => {
                countDown.setNumStr(String(count)).drawImage()
            },
            onComplete: () => {
                //显示抽奖结果
                const winNums = "54178";
                rollNumbers.forEach((colObj, i) => {
                    colObj.setWinner(winNums.charAt(i))
                })

                //改变顶部抽奖结果
                topNumber.setNumStr('54178').drawImage()

                //回复初始值，从新抽奖
                setTimeout(() => {
                    watch.restart()
                    rollNumbers.forEach((colObj, i) => {
                        colObj.reset()
                    })
                }, 3000)
            },
            delayComplete: 1000
        }).start()


        function rand(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        }
    </script>
</body>

</html>